version: '3.8'
services:
  ansible-semaphore:
    image: ghcr.io/imagegenius/semaphore:latest
    container_name: Ansible-Semaphore
    environment:
      PUID: 1000
      PGID: 1000
      TZ: Europe/London
      SEMAPHORE_DB_DIALECT: bolt
      SEMAPHORE_ADMIN: "${ADMIN}"
      SEMAPHORE_ADMIN_PASSWORD: "${PASSWORD}"
      SEMAPHORE_ADMIN_NAME: "${NAME}"
      SEMAPHORE_ADMIN_EMAIL: "${EMAIL}"
      SEMAPHORE_ACCESS_KEY_ENCRYPTION: "${ENCRYPTION_KEY}"
    volumes:
      - /mnt/gluster/containers/semaphore:/config
    ports:
      - 9004:3000
    restart: unless-stopped
    deploy:
      mode: replicated
      replicas: 1
      placement:
        constraints: [node.platform.os == linux]
    networks:
      - proxy
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.ansible-semaphore.entrypoints=https"
      - "traefik.http.routers.ansible-semaphore.tls=true"
      - "traefik.http.routers.ansible-semaphore.rule=Host(`ansible-2.hyvecloud.dev`)"
      - "traefik.http.routers.ansible-semaphore.service=ansible-semaphore-ansible-semaphore@docker"
networks:
  proxy:
    external: true
